@extends('layouts_mapa.app')


@section('content')
	<div id="map"></div>
	<div class="calculation-box">
		<p>Draw a polygon using the draw tools.</p>
		<div id="calculated-area"></div>
	</div>
@endsection

@section('scripts')
	<script src="https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js"></script>
	<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.js"></script>

	<script>

		///////////crear el mapa
        mapboxgl.accessToken = 'pk.eyJ1IjoibHVpc2plc3VzMDciLCJhIjoiY2s4YzkxMWZ2MGgxNTNsczJwZDRyc2VrciJ9.1hUQ7e4IIJYtOXtqfVp_MA';
        var map = new mapboxgl.Map({
            container: 'map', // container id
            style: 'mapbox://styles/mapbox/streets-v11', // stylesheet location
            center: [-112.5, 25.5], // starting position [lng, lat]
            zoom: 6, // starting zoom
            boxZoom: true
        });
        ///////////crear el mapa


        //////////dibujar los municipios
        var draw = new MapboxDraw({
			displayControlsDefault: false,
			controls: {
				polygon: true,
				trash: true
			}
		});
		map.addControl(draw);
		 
		map.on('draw.create', updateArea);
		map.on('draw.delete', updateArea);
		map.on('draw.update', updateArea);
			 
		function updateArea(e) {

			console.log(e)

			var data = draw.getAll();
			var answer = document.getElementById('calculated-area');
			if (data.features.length > 0) {
			var area = turf.area(data);
			// restrict to area to 2 decimal points
			var rounded_area = Math.round(area * 100) / 100;
				answer.innerHTML =
				'<p><strong>' +
				rounded_area +
				'</strong></p><p>square meters</p>';
			} else {
			answer.innerHTML = '';
			if (e.type !== 'draw.delete')
				alert('Use the draw tools to draw a polygon!');
			}

		}
		//////////dibujar los municipios


        //////////pinta en el mapa los municipios
        map.on('load', function() {

			
			map.addSource('urban-areas', {
				'type': 'geojson',
				'data': 
					{
						"type": "FeatureCollection",
						"features": [
							{
							  "id": "100",
						      "type": "Feature",
						      "properties": {
								"nombre": "Los Cabos"
						      },
						      "geometry": {
						        "type": "Polygon",
						        "coordinates": [
							        [
									  [
									    -109.68880135907872,
									    23.654394280627997
									  ],
									  [
									    -109.68062952354333,
									    23.64716118915682
									  ],
									  [
									    -109.67087867949408,
									    23.641867989483316
									  ],
									  [
									    -109.6607666930726,
									    23.638890470588763
									  ],
									  [
									    -109.65354384562862,
									    23.636574575734116
									  ],
									  [
									    -109.64595216416708,
									    23.63387968858723
									  ],
									  [
									    -109.64188678864497,
									    23.633038693341348
									  ],
									  [
									    -109.63952624801918,
									    23.631717118469936
									  ],
									  [
									    -109.63782141312252,
									    23.628953782456747
									  ],
									  [
									    -109.6376902719766,
									    23.62715157538257
									  ],
									  [
									    -109.6344117433299,
									    23.625950090222545
									  ],
									  [
									    -109.62942837978649,
									    23.62450829348272
									  ],
									  [
									    -109.62392045165952,
									    23.623426935513606
									  ],
									  [
									    -109.61500285373958,
									    23.62138434610624
									  ],
									  [
									    -109.61187606694571,
									    23.621162914051382
									  ],
									  [
									    -109.6098251652048,
									    23.621098118638116
									  ],
									  [
									    -109.60925939920725,
									    23.62083893666538
									  ],
									  [
									    -109.6074913804651,
									    23.621746071326456
									  ],
									  [
									    -109.60409678448057,
									    23.619866999701273
									  ],
									  [
									    -109.60437966747934,
									    23.6191542413452
									  ],
									  [
									    -109.60367245998242,
									    23.618247088738357
									  ],
									  [
									    -109.60303597323535,
									    23.617728713000588
									  ],
									  [
									    -109.60183372049076,
									    23.617469524363358
									  ],
									  [
									    -109.60098507149445,
									    23.617275132547945
									  ],
									  [
									    -109.59971209799997,
									    23.617080740444834
									  ],
									  [
									    -109.59850984525536,
									    23.61630316914807
									  ],
									  [
									    -109.59624678126555,
									    23.615201601913398
									  ],
									  [
									    -109.5956102945185,
									    23.614618415510648
									  ],
									  [
									    -109.59426660027451,
									    23.614035226512655
									  ],
									  [
									    -109.59292290603052,
									    23.613840829603546
									  ],
									  [
									    -109.58756728538903,
									    23.610360096464277
									  ],
									  [
									    -109.58149438374029,
									    23.60464899575129
									  ],
									  [
									    -109.57574110849416,
									    23.60010922541271
									  ],
									  [
									    -109.57206540486499,
									    23.599230542032743
									  ],
									  [
									    -109.5683897012354,
									    23.597912505924896
									  ],
									  [
									    -109.56327567879407,
									    23.59630155491662
									  ],
									  [
									    -109.55848128275576,
									    23.59410477165639
									  ],
									  [
									    -109.53099341212855,
									    23.58751420115098
									  ],
									  [
									    -109.52603920288851,
									    23.587074818014145
									  ],
									  [
									    -109.52284293886284,
									    23.584731416436057
									  ],
									  [
									    -109.52012611444107,
									    23.584292023982044
									  ],
									  [
									    -109.51836816922716,
									    23.58297383779214
									  ],
									  [
									    -109.51724947681802,
									    23.581362703359844
									  ],
									  [
									    -109.51804854282454,
									    23.579751549151823
									  ],
									  [
									    -109.51820835602584,
									    23.577261544662107
									  ],
									  [
									    -109.5170896636167,
									    23.575357391715883
									  ],
									  [
									    -109.51549153160408,
									    23.572720826661964
									  ],
									  [
									    -109.51549153160408,
									    23.571402524283243
									  ],
									  [
									    -109.51437283919495,
									    23.570377168839272
									  ],
									  [
									    -109.51261489398101,
									    23.56949828637235
									  ],
									  [
									    -109.51069713556537,
									    23.56861939802404
									  ],
									  [
									    -109.5079803111436,
									    23.56774050379444
									  ],
									  [
									    -109.50686161873487,
									    23.567154571040803
									  ],
									  [
									    -109.50478404711794,
									    23.56612918243289
									  ],
									  [
									    -109.50350554150789,
									    23.565396757098114
									  ],
									  [
									    -109.50206722269617,
									    23.56495729993641
									  ],
									  [
									    -109.49951021147571,
									    23.564371354767772
									  ],
									  [
									    -109.49743263985917,
									    23.56407838120343
									  ],
									  [
									    -109.4947158154374,
									    23.56378540698563
									  ],
									  [
									    -109.49263824382044,
									    23.56319945659071
									  ],
									  [
									    -109.49008123259999,
									    23.56275999207851
									  ],
									  [
									    -109.48768403458084,
									    23.56202754795919
									  ],
									  [
									    -109.48512702336038,
									    23.561734569167953
									  ],
									  [
									    -109.48241019893862,
									    23.561002119331164
									  ],
									  [
									    -109.47921393491295,
									    23.560416156522905
									  ],
									  [
									    -109.47729617649729,
									    23.559830191100687
									  ],
									  [
									    -109.47521860488074,
									    23.559244223065306
									  ],
									  [
									    -109.4686250178135,
									    23.5546961935394
									  ],
									  [
									    -109.46814557820957,
									    23.552498714087903
									  ],
									  [
									    -109.46878483101479,
									    23.55015469551178
									  ],
									  [
									    -109.47038296302742,
									    23.54781063513839
									  ],
									  [
									    -109.47246053464438,
									    23.546052562431584
									  ],
									  [
									    -109.47405866665703,
									    23.543854938489744
									  ],
									  [
									    -109.47501754586484,
									    23.541950301364267
									  ],
									  [
									    -109.47677549107878,
									    23.539313065957714
									  ],
									  [
									    -109.47789418348789,
									    23.53696881231332
									  ],
									  [
									    -109.47869324949443,
									    23.534917556102997
									  ],
									  [
									    -109.47965212870184,
									    23.531987134603057
									  ],
									  [
									    -109.48029138150706,
									    23.52905664783421
									  ],
									  [
									    -109.48061100790966,
									    23.526126095801104
									  ],
									  [
									    -109.48061100790966,
									    23.522755880290177
									  ],
									  [
									    -109.48013156830577,
									    23.52011826013046
									  ],
									  [
									    -109.47885306269573,
									    23.515868649826103
									  ],
									  [
									    -109.47565568329917,
									    23.512644716023132
									  ],
									  [
									    -109.47453699089003,
									    23.510299987326704
									  ],
									  [
									    -109.4727790456761,
									    23.507662117646376
									  ],
									  [
									    -109.47054166085785,
									    23.504437982964987
									  ],
									  [
									    -109.46878371564391,
									    23.500920655138614
									  ],
									  [
									    -109.46718558363085,
									    23.497989476892755
									  ],
									  [
									    -109.46510801201431,
									    23.495791050421857
									  ],
									  [
									    -109.4635098800017,
									    23.494178847703353
									  ],
									  [
									    -109.46143230838473,
									    23.490807814660883
									  ],
									  [
									    -109.46063324237862,
									    23.48816955475702
									  ],
									  [
									    -109.460313615976,
									    23.486410685492004
									  ],
									  [
									    -109.45791641795645,
									    23.484651792763984
									  ],
									  [
									    -109.45487996713207,
									    23.482892876575008
									  ],
									  [
									    -109.45232295591161,
									    23.481427095163596
									  ],
									  [
									    -109.44976594469117,
									    23.479668135967145
									  ],
									  [
									    -109.447368746672,
									    23.47790915331278
									  ],
									  [
									    -109.44529117505547,
									    23.475124049473905
									  ],
									  [
									    -109.44481173545019,
									    23.47145934958324
									  ],
									  [
									    -109.44353322984017,
									    23.46735476486556
									  ],
									  [
									    -109.44193509782713,
									    23.464569438245192
									  ],
									  [
									    -109.43937808660667,
									    23.462223854450116
									  ],
									  [
									    -109.43698088858753,
									    23.46075784341295
									  ],
									  [
									    -109.43394443776315,
									    23.458852004727106
									  ],
									  [
									    -109.4320266793479,
									    23.45826558728885
									  ],
									  [
									    -109.42962948132833,
									    23.457679167246084
									  ],
									  [
									    -109.42803134931572,
									    23.45548006889021
									  ],
									  [
									    -109.42675284370527,
									    23.45313432361047
									  ],
									  [
									    -109.42611359090006,
									    23.4515215995616
									  ],
									  [
									    -109.42547433809526,
									    23.44902916911599
									  ],
									  [
									    -109.42483508529004,
									    23.446536691640276
									  ],
									  [
									    -109.42387620608221,
									    23.44565698247959
									  ],
									  [
									    -109.42499489849135,
									    23.44463064772232
									  ],
									  [
									    -109.42627340410137,
									    23.44287119816026
									  ],
									  [
									    -109.42755190971181,
									    23.43979210505192
									  ],
									  [
									    -109.42707247010789,
									    23.437592708906422
									  ],
									  [
									    -109.42627340410137,
									    23.43510001569453
									  ],
									  [
									    -109.42755190971181,
									    23.431727473584843
									  ],
									  [
									    -109.42915004172443,
									    23.428648120865603
									  ],
									  [
									    -109.43138742653755,
									    23.4213160400287
									  ],
									  [
									    -109.43234630574497,
									    23.418089795686285
									  ],
									  [
									    -109.43218649254365,
									    23.413836898835456
									  ],
									  [
									    -109.43122761333625,
									    23.410903786874727
									  ],
									  [
									    -109.43010892092711,
									    23.407823949346735
									  ],
									  [
									    -109.42835097571319,
									    23.405624021518847
									  ],
									  [
									    -109.42355657967445,
									    23.40342405712778
									  ],
									  [
									    -109.4206799420514,
									    23.402837393781965
									  ],
									  [
									    -109.4160453592144,
									    23.40254406113408
									  ],
									  [
									    -109.41700139509474,
									    23.396968007803565
									  ],
									  [
									    -109.41748083469868,
									    23.39506124945386
									  ],
									  [
									    -109.41572288948431,
									    23.390074213211932
									  ],
									  [
									    -109.41364531786778,
									    23.387433941540166
									  ],
									  [
									    -109.41316587826387,
									    23.38450024463431
									  ],
									  [
									    -109.4150836366791,
									    23.382299929327417
									  ],
									  [
									    -109.41716120829606,
									    23.381859861882063
									  ],
									  [
									    -109.42035747232173,
									    23.38259330681271
									  ],
									  [
									    -109.4232341099448,
									    23.38259330681271
									  ],
									  [
									    -109.42802850598311,
									    23.38009957748534
									  ],
									  [
									    -109.43154439641138,
									    23.377752495253816
									  ],
									  [
									    -109.43154439641138,
									    23.37452518932085
									  ],
									  [
									    -109.42994626439834,
									    23.369830785889164
									  ],
									  [
									    -109.42882757198963,
									    23.36689669933982
									  ],
									  [
									    -109.42770371418615,
									    23.364104515134343
									  ],
									  [
									    -109.42642520857572,
									    23.36102358952904
									  ],
									  [
									    -109.42626539537443,
									    23.35544839939638
									  ],
									  [
									    -109.42818315378966,
									    23.351633660638953
									  ],
									  [
									    -109.42738408778355,
									    23.34605807597393
									  ],
									  [
									    -109.42674483497834,
									    23.34106919644158
									  ],
									  [
									    -109.42497923005361,
									    23.338129785174146
									  ],
									  [
									    -109.4243399772484,
									    23.334167806663103
									  ],
									  [
									    -109.42545866965753,
									    23.329471975386085
									  ],
									  [
									    -109.42625773566364,
									    23.324922730548124
									  ],
									  [
									    -109.42785586767668,
									    23.31875898908902
									  ],
									  [
									    -109.42769605447538,
									    23.315530248531104
									  ],
									  [
									    -109.42593810926101,
									    23.31098052646287
									  ],
									  [
									    -109.42529885645621,
									    23.308191910180227
									  ],
									  [
									    -109.42545866965753,
									    23.303788712783714
									  ],
									  [
									    -109.42737642807275,
									    23.300559608716867
									  ],
									  [
									    -109.42897456007836,
									    23.29400480000558
									  ],
									  [
									    -109.43201101090274,
									    23.28930755007333
									  ],
									  [
									    -109.4352072749284,
									    23.28152736524521
									  ],
									  [
									    -109.43968204456411,
									    23.27081051733279
									  ],
									  [
									    -109.43808391255148,
									    23.260092807275697
									  ],
									  [
									    -109.43744465974625,
									    23.252751412650085
									  ],
									  [
									    -109.43648578053843,
									    23.245850133135733
									  ],
									  [
									    -109.44143998977755,
									    23.230871659966
									  ],
									  [
									    -109.44591475941324,
									    23.22396924869905
									  ],
									  [
									    -109.45134840825675,
									    23.216038378237954
									  ],
									  [
									    -109.45438485908113,
									    23.207666392991456
									  ],
									  [
									    -109.46269514554612,
									    23.19238984032222
									  ],
									  [
									    -109.4786764656745,
									    23.17461396235899
									  ],
									  [
									    -109.49561666501029,
									    23.150958100402036
									  ],
									  [
									    -109.55673559666123,
									    23.09888372493789
									  ],
									  [
									    -109.60462714985462,
									    23.071673809389054
									  ],
									  [
									    -109.68488391465051,
									    23.050235421001588
									  ],
									  [
									    -109.718539977307,
									    23.004965393250615
									  ],
									  [
									    -109.74701818417029,
									    22.979050451618548
									  ],
									  [
									    -109.80656352579308,
									    22.948061524781806
									  ],
									  [
									    -109.82986387686279,
									    22.900372395007594
									  ],
									  [
									    -109.89458707427916,
									    22.881292045061713
									  ],
									  [
									    -109.96189919959211,
									    22.874136222289366
									  ],
									  [
									    -110.0240334691119,
									    22.893217578183283
									  ],
									  [
									    -110.0758120270449,
									    22.948061524781806
									  ],
									  [
									    -110.09393452232143,
									    23.005266301606085
									  ],
									  [
									    -110.10946808970138,
									    23.055300599090558
									  ],
									  [
									    -110.12241272918432,
									    23.117222065587782
									  ],
									  [
									    -110.06286738756155,
									    23.13626908252985
									  ],
									  [
									    -110.02921132490506,
									    23.141030414157186
									  ],
									  [
									    -109.97743276697204,
									    23.16245431351733
									  ],
									  [
									    -109.94377670431558,
									    23.16483453530161
									  ],
									  [
									    -109.87387565110603,
									    23.25287297065813
									  ],
									  [
									    -109.88940921848598,
									    23.359868440480582
									  ],
									  [
									    -109.85316422793292,
									    23.35511491503918
									  ],
									  [
									    -109.77031853524001,
									    23.35511491503918
									  ],
									  [
									    -109.84021958844956,
									    23.366998409269428
									  ],
									  [
									    -109.80915245368966,
									    23.393138347914658
									  ],
									  [
									    -109.68880135907872,
									    23.654394280627997
									  ]
									]
						        ]
						      }
						    },
						    {
						      "id": "200",
						      "type": "Feature",
						      "properties": {
						      	"nombre": "Comondu"
						      },
						      "geometry": {
						        "type": "Polygon",
						        "coordinates": [
							        [
							            [
							              -111.42778344593556,
							              24.92302108466447
							            ],
							            [
							              -110.8564943834355,
							              24.893127791563316
							            ],
							            [
							              -110.8564943834355,
							              24.493861335969882
							            ],
							            [
							              -111.40581078968565,
							              24.493861335969882
							            ],
							            [
							              -111.42778344593556,
							              24.92302108466447
							            ]
							        ]
						        ]
						      }
						    }
						]
					}
			});
			map.addLayer({
					'id': 'urban-areas-fill',
					'type': 'fill',
					'source': 'urban-areas',
					'layout': {},
					'paint': {
						'fill-color': '#f08',
						'fill-opacity': 0.4
					}
				}
			);
		});
		//////////pinta en el mapa los municipios


		//////////obtener los lugares pertenecientes al municipio
		//////////por el cual se pasa el mouse
		map.on('mouseover', 'urban-areas-fill', function(e) {
			console.log(e)

		});
		//////////obtener los lugares pertenecientes al municipio
		//////////por el cual se pasa el mouse
		

		//////////json de los lugares
        var geojson = {
		  type: 'FeatureCollection',
		  features: [{
		    geometry: {
		      coordinates: [-77.032, 38.913]
		    },
		    properties: {
		      name: 'Mapbox',
		      description: 'Washington, D.C.'
		    }
		  },
		  {
		    geometry: {
		      coordinates: [-122.414, 37.776]
		    },
		    properties: {
		      name: 'Mapbox',
		      description: 'San Francisco, California'
		    }
		  },
		  {
		    geometry: {
		      coordinates: [-109.514, 23.400]
		    },
		    properties: {
		      name: 'Restaurante',
		      description: 'Restaurante de mariscos'

		    }
		  }]
		};
		//////////json de los lugares


		//////////pone los lugares en el mapa
		// add markers to map
		geojson.features.forEach(function(marker) {

		  // create a HTML element for each feature
		  var el = document.createElement('div');
		  el.className = 'marker';

		  // make a marker for each feature and add to the map
		  new mapboxgl.Marker(el)
		    .setLngLat(marker.geometry.coordinates)
		    .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
    			.setHTML('<h3>' + marker.properties.name + '</h3><p>' + marker.properties.description + '</p>'))
		    .addTo(map);
		});
		//////////pone los lugares en el mapa

    </script>
@endsection